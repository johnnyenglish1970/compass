<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Compass Heading Test</title>
<style>
  body {
    font-family: system-ui, sans-serif;
    text-align: center;
    margin: 0;
    padding: 40px;
    background: linear-gradient(to bottom, #eef3ff, #cfdcff);
    color: #222;
  }
  h1 { color: #0057B8; }
  #heading {
    font-size: 3em;
    margin-top: 40px;
    color: #0078D7;
  }
  button {
    background: #0057B8;
    color: white;
    border: none;
    border-radius: 8px;
    padding: 12px 24px;
    font-size: 1.2em;
    cursor: pointer;
    margin-top: 30px;
  }
  button:disabled {
    opacity: 0.5;
  }
  .log {
    margin-top: 20px;
    white-space: pre-line;
    font-family: monospace;
    color: #333;
  }
</style>
</head>
<body>
  <h1>ğŸ“± Compass Test</h1>
  <p>Tap the button below to grant motion access and see live heading updates.</p>
  <button id="enableCompass">Enable Compass</button>

  <div id="heading">-- Â°</div>
  <div class="log" id="log"></div>

  <script>
    const headingDisplay = document.getElementById('heading');
    const logBox = document.getElementById('log');
    const btn = document.getElementById('enableCompass');

    function log(msg) {
      console.log(msg);
      logBox.textContent += msg + "\n";
    }

    function startCompass() {
      log("ğŸ§­ Starting compass listener...");
      window.addEventListener("deviceorientation", (event) => {
        let heading;
        if (event.webkitCompassHeading !== undefined) {
          heading = event.webkitCompassHeading;
        } else if (event.alpha !== null) {
          heading = 360 - event.alpha;
        }

        if (heading !== undefined && !isNaN(heading)) {
          headingDisplay.textContent = heading.toFixed(1) + "Â°";
        } else {
          headingDisplay.textContent = "No data";
        }
      }, true);
    }

    btn.addEventListener("click", async () => {
      log("ğŸ“± Requesting permission...");
      if (typeof DeviceOrientationEvent !== "undefined" &&
          typeof DeviceOrientationEvent.requestPermission === "function") {
        try {
          const res = await DeviceOrientationEvent.requestPermission();
          log("ğŸ” Permission response: " + res);
          if (res === "granted") {
            btn.textContent = "âœ… Compass Active";
            btn.disabled = true;
            startCompass();
          } else {
            log("ğŸš« Permission denied.");
          }
        } catch (err) {
          log("âŒ Error requesting permission: " + err);
        }
      } else {
        log("ğŸ¤– No permission request API â€” starting directly.");
        startCompass();
      }
    });
  </script>
</body>
</html>
